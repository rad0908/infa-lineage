
<!doctype html>
<html>
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Informatica Lineage Lookup</title>
    <style>
      body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
      input, button { font-size: 16px; padding: 8px 12px; }
      table { border-collapse: collapse; width: 100%; margin-top: 16px; }
      th, td { border: 1px solid #ddd; padding: 8px; font-size: 14px; }
      th { background: #f3f3f3; position: sticky; top: 0; }
      .rowcount { margin-top: 8px; color: #555; }
      .controls { display: flex; gap: 8px; flex-wrap: wrap; }
    </style>
  </head>
  <body>
    <h1>Informatica Lineage Lookup</h1>
    <div class="controls">
      <input id="field" placeholder="Search field e.g. OUTSTANDING_BAL" style="min-width: 320px;">
      <button onclick="lookup()">Lookup</button>
      <button onclick="resetLoad()">Reload XMLs</button>
    </div>
    <div class="rowcount" id="status"></div>
    <table id="results">
      <thead>
        <tr>
          <th>#</th><th>Mapping</th><th>From Instance</th><th>From Port</th><th>To Instance</th><th>To Port</th>
          <th>Operation</th><th>Expression</th><th>Join</th><th>Stage</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <script>
      async function lookup() {
        const q = document.getElementById('field').value || '';
        const res = await fetch(`/api/lookup?field=${encodeURIComponent(q)}`);
        const rows = await res.json();
        const tbody = document.querySelector('#results tbody');
        tbody.innerHTML = '';
        for (const r of rows) {
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td>${r.hop_no ?? ""}</td>
            <td>${r.mapping ?? ""}</td>
            <td>${r.from_instance ?? ""}</td>
            <td>${r.from_port ?? ""}</td>
            <td>${r.to_instance ?? ""}</td>
            <td>${r.to_port ?? ""}</td>
            <td>${r.operation ?? ""}</td>
            <td>${r.expression ?? ""}</td>
            <td>${r.join_condition ?? ""}</td>
            <td>${r.stage ?? ""}</td>`;
          tbody.appendChild(tr);
        }
        document.getElementById('status').textContent = `${rows.length} row(s)`;
      }
      async function resetLoad() {
        const res = await fetch('/api/reset', {method:'POST'});
        const info = await res.json();
        document.getElementById('status').textContent = `Reloaded ${info.files} XML file(s) from ${info.dir}`;
      }
    </script>
  </body>
</html>
